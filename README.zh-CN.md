
# ğŸ“š `dcron` åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£

`dcron` æ˜¯ä¸€ä¸ªåŸºäºå¤šç§æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Consulã€Redisã€Etcdã€ZooKeeperï¼‰å®ç°çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ç³»ç»Ÿã€‚å®ƒæ”¯æŒé™æ€ä»»åŠ¡å’ŒåŠ¨æ€ä»»åŠ¡çš„ç®¡ç†ï¼Œå¹¶æä¾›æœåŠ¡èŠ‚ç‚¹çš„å‘ç°ä¸è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼Œæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æä¾›é«˜æ•ˆã€å¯é çš„è§£å†³æ–¹æ¡ˆã€‚

---

## å¯¼èˆª

*   [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
*   [å®‰è£…ä¾èµ–](#-å®‰è£…ä¾èµ–)
*   [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
    *   [1. åˆå§‹åŒ–æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯](#1-åˆå§‹åŒ–æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ä»¥-consul-ä¸ºä¾‹)
    *   [2. åˆ›å»º Dcron å®ä¾‹](#2-åˆ›å»º-dcron-å®ä¾‹)
    *   [3. æ·»åŠ é™æ€ä»»åŠ¡](#3-æ·»åŠ é™æ€ä»»åŠ¡)
    *   [4. æ·»åŠ åŠ¨æ€ä»»åŠ¡](#4-æ·»åŠ åŠ¨æ€ä»»åŠ¡)
    *   [5. å¯åŠ¨æœåŠ¡](#5-å¯åŠ¨æœåŠ¡)
*   [æ³¨å†Œä¸­å¿ƒç¤ºä¾‹](#-æ³¨å†Œä¸­å¿ƒç¤ºä¾‹)
    *   [Consul Registry ç¤ºä¾‹](#consul-registry-ç¤ºä¾‹)
    *   [Redis Registry ç¤ºä¾‹](#redis-registry-ç¤ºä¾‹)
    *   [Etcd Registry ç¤ºä¾‹](#etcd-registry-ç¤ºä¾‹)
    *   [ZooKeeper Registry ç¤ºä¾‹](#zookeeper-registry-ç¤ºä¾‹)
*   [æ ¸å¿ƒæ¦‚å¿µä¸æœºåˆ¶](#-æ ¸å¿ƒæ¦‚å¿µä¸æœºåˆ¶)
    *   [åŠ¨æ€ä»»åŠ¡åˆ é™¤ä¸åŒæ­¥](#åŠ¨æ€ä»»åŠ¡åˆ é™¤ä¸åŒæ­¥)
    *   [ç”Ÿå‘½å‘¨æœŸä¸èŠ‚ç‚¹çŠ¶æ€](#ç”Ÿå‘½å‘¨æœŸä¸èŠ‚ç‚¹çŠ¶æ€)
    *   [åˆ†å¸ƒå¼é”æœºåˆ¶](#åˆ†å¸ƒå¼é”æœºåˆ¶)
*   [é…ç½®ä¸ API å‚è€ƒ](#-é…ç½®ä¸-api-å‚è€ƒ)
    *   [å¯é€‰é…ç½®é¡¹ (Option)](#å¯é€‰é…ç½®é¡¹-option)
    *   [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
    *   [åŠ¨æ€ä»»åŠ¡ç»Ÿä¸€å¤„ç†å‡½æ•°](#åŠ¨æ€ä»»åŠ¡ç»Ÿä¸€å¤„ç†å‡½æ•°)
    *   [åŠ¨æ€ä»»åŠ¡ API](#åŠ¨æ€ä»»åŠ¡-api)
    *   [ä¸»è¦ API æè¿°](#ä¸»è¦-api-æè¿°)
    *   [TaskMeta ç»“æ„ä½“](#taskmeta-ç»“æ„ä½“)
    *   [Node ç»“æ„ä½“](#node-ç»“æ„ä½“)
    *   [NodeEvent & TaskEvent](#nodeevent--taskevent)
*   [å¸¸è§é—®é¢˜ (FAQ) / ä½¿ç”¨å»ºè®®](#-å¸¸è§é—®é¢˜-faq--ä½¿ç”¨å»ºè®®)
*   [æ€»ç»“](#-æ€»ç»“)

---

## ğŸ§© åŠŸèƒ½ç‰¹æ€§

*   **âœ¨ å¤šç§æ³¨å†Œä¸­å¿ƒæ”¯æŒ**ï¼šæ— ç¼å¯¹æ¥ Consulã€Redisã€Etcd å’Œ Zookeeperï¼Œçµæ´»é€‰æ‹©ï¼Œè½»æ¾åˆ‡æ¢ã€‚
*   **ğŸš€ é™æ€ä¸åŠ¨æ€ä»»åŠ¡ç®¡ç†**ï¼šæ—¢æ”¯æŒä»£ç ä¸­é¢„å®šä¹‰çš„é™æ€ä»»åŠ¡ï¼Œä¹Ÿæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„ä»»åŠ¡ï¼Œæ»¡è¶³å„ç§è°ƒåº¦éœ€æ±‚ã€‚
*   **ğŸ‘€ æ™ºèƒ½èŠ‚ç‚¹å˜åŒ–ç›‘å¬**ï¼šç»“åˆ Poll å’Œ Watch æ¨¡å¼ï¼Œå®æ—¶æ„ŸçŸ¥èŠ‚ç‚¹å˜åŒ–ï¼Œç¡®ä¿ä»»åŠ¡è°ƒåº¦çš„é«˜å¯ç”¨å’ŒåŠæ—¶æ€§ã€‚
*   **ğŸ¯ ä¸°å¯Œä»»åŠ¡è°ƒåº¦ç­–ç•¥**ï¼šå†…ç½®ä¸€è‡´æ€§å“ˆå¸Œã€å¹³å‡åˆ†é…ã€å“ˆå¸Œæ§½ã€èŒƒå›´åˆ†é…ã€åŠ æƒåˆ†é…å’Œè½®è¯¢ç­‰å¤šç§ç­–ç•¥ï¼Œä¼˜åŒ–ä»»åŠ¡åˆ†é…ï¼Œæå‡ç³»ç»Ÿè´Ÿè½½å‡è¡¡èƒ½åŠ›ã€‚
*   **ğŸš¦ ç²¾ç»†èŠ‚ç‚¹çŠ¶æ€ç®¡ç†**ï¼šæ¸…æ™°ç®¡ç†èŠ‚ç‚¹ä»å¯åŠ¨ (`starting`)ã€å·¥ä½œ (`working`) åˆ°é€€å‡º (`leaving`) çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚
*   **ğŸ”§ çµæ´»çš„åŠ¨æ€ä»»åŠ¡é…ç½®**ï¼šåŠ¨æ€ä»»åŠ¡æ”¯æŒä¸€æ¬¡æ€§æ‰§è¡Œ (OneShot) å¹¶å¯æºå¸¦è‡ªå®šä¹‰æ•°æ® (Payload)ã€‚
*   **ğŸ›¡ï¸ å¯é é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šæä¾›ä»»åŠ¡æ‰§è¡Œé”™è¯¯çš„å›è°ƒå¤„ç†ï¼Œä¿éšœä»»åŠ¡æ‰§è¡Œçš„ç¨³å®šæ€§å’Œå¯è¿½æº¯æ€§ã€‚
*   **ğŸ”„ å·²åˆ é™¤ä»»åŠ¡æ™ºèƒ½åŒæ­¥**ï¼šåŠ¨æ€ä»»åŠ¡åˆ é™¤åï¼Œè‡ªåŠ¨åŒæ­¥è‡³æ³¨å†Œä¸­å¿ƒå·²åˆ é™¤åˆ—è¡¨ï¼Œæœ‰æ•ˆé˜²æ­¢è„æ•°æ®å’Œä»»åŠ¡é‡è·‘ã€‚
*   **ğŸ”’ å†…ç½®åˆ†å¸ƒå¼é”**ï¼šé€šè¿‡ `CanRunTask` æ¥å£å®ç°åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åŒä¸€ä»»åŠ¡åœ¨é›†ç¾¤ä¸­ä»…è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…å¹¶å‘å†²çªã€‚
*   **â™»ï¸ å®Œå–„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ”¯æŒä»»åŠ¡æ‰§è¡Œåè‡ªåŠ¨åˆ é™¤æˆ–æ¸…ç†ï¼Œç‰¹åˆ«é€‚åˆä¸€æ¬¡æ€§ä»»åŠ¡å’Œä¸´æ—¶æ€§ä»»åŠ¡åœºæ™¯ã€‚

---

## ğŸ“¦ å®‰è£…ä¾èµ–

åœ¨ä½¿ç”¨ `dcron` ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„é¡¹ç›®ä¸­å·²å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

```bash
# Consul Registry (å¦‚æœæ‚¨é€‰æ‹© Consul)
go get github.com/hashicorp/consul/api

# Redis Registry (å¦‚æœæ‚¨é€‰æ‹© Redis)
go get github.com/redis/go-redis/v9

# Etcd Registry (å¦‚æœæ‚¨é€‰æ‹© Etcd)
go get go.etcd.io/etcd/client/v3

# ZooKeeper Registry (å¦‚æœæ‚¨é€‰æ‹© ZooKeeper)
go get github.com/go-zookeeper/zk

# Cron Scheduler (æ ¸å¿ƒè°ƒåº¦åº“)
go get github.com/robfig/cron/v3
```

--- 

## ğŸ§° å¿«é€Ÿå¼€å§‹

æœ¬èŠ‚å°†ä»¥ Consul ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå¼•å¯¼æ‚¨å¿«é€Ÿä¸Šæ‰‹ `dcron`ã€‚

### 1. åˆå§‹åŒ–æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ï¼ˆä»¥ Consul ä¸ºä¾‹ï¼‰

é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Consul çš„ç¤ºä¾‹ä»£ç ï¼š

```go
import (
    "log"
    "github.com/kkangxu/dcron"
    "github.com/hashicorp/consul/api"
)

func main() {
    // é…ç½® Consul å®¢æˆ·ç«¯
    config := api.DefaultConfig()
    config.Address = "localhost:8500" // Consul æœåŠ¡åœ°å€
    client, err := api.NewClient(config)
    if err != nil {
        log.Fatalf("åˆ›å»º Consul å®¢æˆ·ç«¯å¤±è´¥: %v", err)
    }

    // åŸºäº Consul å®¢æˆ·ç«¯åˆ›å»º dcron Registry
    registry := dcron.NewConsulRegistry(client)
    
    // ... æ¥ä¸‹æ¥åˆ›å»º Dcron å®ä¾‹
}
```

> **æç¤º**ï¼šå…¶ä»–æ³¨å†Œä¸­å¿ƒï¼ˆRedis, Etcd, ZooKeeperï¼‰çš„åˆå§‹åŒ–æ–¹å¼ç±»ä¼¼ï¼Œè¯·å‚è€ƒ [æ³¨å†Œä¸­å¿ƒç¤ºä¾‹](#-æ³¨å†Œä¸­å¿ƒç¤ºä¾‹) éƒ¨åˆ†ã€‚

### 2. åˆ›å»º Dcron å®ä¾‹

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª `Dcron` å®ä¾‹å¹¶é…ç½®ç›¸å…³é€‰é¡¹ï¼š

```go
import (
    "fmt"
    "log"
    "github.com/kkangxu/dcron"
    "github.com/robfig/cron/v3" // ç”¨äº cron Options
    // ... å…¶ä»– import
)

// ... åœ¨ main å‡½æ•°ä¸­ç»§ç»­

// åˆ›å»º Dcron å®ä¾‹
dc := dcron.NewDcron(
    registry, // ä¸Šä¸€æ­¥åˆ›å»ºçš„ registry å®ä¾‹
    dcron.WithStrategy(dcron.StrategyConsistent), // è®¾ç½®ä»»åŠ¡åˆ†é…ç­–ç•¥ä¸ºä¸€è‡´æ€§å“ˆå¸Œ
    dcron.WithCronOptions(cron.WithSeconds()),    // è®¾ç½® Cron è¡¨è¾¾å¼æ”¯æŒç§’çº§ç²¾åº¦
    dcron.WithTaskRunFunc(func(task *dcron.TaskMeta) error { // è®¾ç½®åŠ¨æ€ä»»åŠ¡çš„ç»Ÿä¸€æ‰§è¡Œå‡½æ•°
        fmt.Println("æ‰§è¡ŒåŠ¨æ€ä»»åŠ¡:", task.Name, "Payload:", task.Payload)
        return nil
    }),
    dcron.WithErrHandler(func(task *dcron.TaskMeta, err error) { // è®¾ç½®ä»»åŠ¡æ‰§è¡Œé”™è¯¯å¤„ç†å‡½æ•°
        fmt.Printf("ä»»åŠ¡ %s æ‰§è¡Œå‡ºé”™: %v\n", task.Name, err)
    }),
)
```

### 3. æ·»åŠ é™æ€ä»»åŠ¡

é™æ€ä»»åŠ¡é€šå¸¸åœ¨ä»£ç ä¸­å®šä¹‰ï¼ŒéšæœåŠ¡å¯åŠ¨è€ŒåŠ è½½ã€‚

```go
// ... åœ¨ main å‡½æ•°ä¸­ç»§ç»­

// æ·»åŠ ä¸€ä¸ªæ¯5ç§’æ‰§è¡Œä¸€æ¬¡çš„é™æ€ä»»åŠ¡
err = dc.AddFunc("static-task-example", "*/5 * * * * *", func() error {
    fmt.Println("æ¯5ç§’æ‰§è¡Œä¸€æ¬¡é™æ€ä»»åŠ¡ (static-task-example)")
    return nil
})
if err != nil {
    log.Fatalf("æ·»åŠ é™æ€ä»»åŠ¡å¤±è´¥: %v", err)
}
```

#### ğŸš© å¼ºåˆ¶æ·»åŠ ä»»åŠ¡ï¼ˆæ— è§†é™åˆ¶ï¼‰

å¦‚æœæ‚¨éœ€è¦æ— è§†ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨ã€å·²è¢«åˆ é™¤ç­‰é™åˆ¶ï¼Œå¼ºåˆ¶æ·»åŠ æˆ–è¦†ç›–ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ `ForceAdd` ç³»åˆ—æ–¹æ³•ï¼š

```go
// å¼ºåˆ¶æ·»åŠ ä¸€ä¸ªæ™®é€šä»»åŠ¡ï¼Œå³ä½¿å·²å­˜åœ¨æˆ–å·²åˆ é™¤ä¹Ÿä¼šè¦†ç›–
_ = dc.ForceAddFunc("force-task-example", "*/3 * * * * *", func() error {
    fmt.Println("å¼ºåˆ¶æ·»åŠ çš„ä»»åŠ¡ (force-task-example)ï¼Œæ¯3ç§’æ‰§è¡Œä¸€æ¬¡")
    return nil
})

// å¼ºåˆ¶æ·»åŠ ä¸€ä¸ªä¸€æ¬¡æ€§ä»»åŠ¡
_ = dc.ForceAddOneShotFunc("force-oneshot-example", "*/10 * * * * *", func() error {
    fmt.Println("å¼ºåˆ¶æ·»åŠ çš„ä¸€æ¬¡æ€§ä»»åŠ¡ (force-oneshot-example)")
    return nil // ä»»åŠ¡æ‰§è¡Œåä¼šè‡ªåŠ¨æ¸…ç†
})
```
> **æ³¨æ„**ï¼š`ForceAdd` ç³»åˆ—æ–¹æ³•ä¼šç›´æ¥è¦†ç›–åŒåä»»åŠ¡ï¼Œå¹¶æ¸…é™¤å…¶åœ¨æ³¨å†Œä¸­å¿ƒçš„ç›¸å…³è®°å½•ï¼ˆå¦‚å·²åˆ é™¤æ ‡è®°ï¼‰ã€‚è¯·è°¨æ…ä½¿ç”¨ã€‚

### 4. æ·»åŠ åŠ¨æ€ä»»åŠ¡

åŠ¨æ€ä»»åŠ¡å¯ä»¥åœ¨æœåŠ¡è¿è¡Œæ—¶é€šè¿‡ API æ·»åŠ ï¼Œå…¶å…ƒæ•°æ®å­˜å‚¨åœ¨æ³¨å†Œä¸­å¿ƒã€‚

```go
// ... åœ¨ main å‡½æ•°ä¸­ç»§ç»­

// æ·»åŠ ä¸€ä¸ªåŠ¨æ€ä»»åŠ¡ï¼Œæ¯10ç§’æ‰§è¡Œä¸€æ¬¡
err = dc.AddTaskMeta(dcron.TaskMeta{
    Name:       "dynamic-task-example",
    CronFormat: "*/10 * * * * *",
    Payload:    "æ¥è‡ªåŠ¨æ€ä»»åŠ¡çš„é—®å€™",
})
if err != nil {
    log.Fatalf("æ·»åŠ åŠ¨æ€ä»»åŠ¡å¤±è´¥: %v", err)
}
```
åŠ¨æ€ä»»åŠ¡å°†ç”± `WithTaskRunFunc` ä¸­è®¾ç½®çš„å¤„ç†å™¨æ‰§è¡Œã€‚

### 5. å¯åŠ¨æœåŠ¡

æœ€åï¼Œå¯åŠ¨ `Dcron` æœåŠ¡å¼€å§‹ä»»åŠ¡è°ƒåº¦ï¼š

```go
// ... åœ¨ main å‡½æ•°ä¸­ç»§ç»­

log.Println("Dcron æœåŠ¡å³å°†å¯åŠ¨...")
if err := dc.Start(); err != nil {
    log.Fatalf("Dcron æœåŠ¡å¯åŠ¨å¤±è´¥: %v", err)
}

// é˜»å¡ä¸» goroutineï¼Œæˆ–è€…æ ¹æ®æ‚¨çš„åº”ç”¨é€»è¾‘å¤„ç†
select {}
```

---

## ğŸ§° æ³¨å†Œä¸­å¿ƒç¤ºä¾‹

`dcron` æ”¯æŒå¤šç§æ³¨å†Œä¸­å¿ƒã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä¸ºæ¯ç§æ”¯æŒçš„æ³¨å†Œä¸­å¿ƒåˆå§‹åŒ–å®¢æˆ·ç«¯å¹¶åˆ›å»º `Dcron` å®ä¾‹çš„ç¤ºä¾‹ã€‚

#### Consul Registry ç¤ºä¾‹

```go
package main

import (
    "github.com/robfig/cron/v3"
    "github.com/kkangxu/dcron"
    "github.com/hashicorp/consul/api"
    "log"
    "fmt"
)

func main() {
    // 1. é…ç½® Consul å®¢æˆ·ç«¯
    config := api.DefaultConfig()
    config.Address = "localhost:8500" // Consul æœåŠ¡åœ°å€
    client, err := api.NewClient(config)
    if err != nil {
        log.Fatalf("åˆ›å»º Consul å®¢æˆ·ç«¯å¤±è´¥: %v", err)
    }
    
    // 2. åˆ›å»º Dcron å®ä¾‹ï¼Œä½¿ç”¨ Consul Registry
    dc := dcron.NewDcron(dcron.NewConsulRegistry(client), dcron.WithStrategy(dcron.StrategyConsistent), dcron.WithCronOptions(cron.WithSeconds()))
    
    // 3. æ·»åŠ é™æ€ä»»åŠ¡ç¤ºä¾‹
    err = dc.AddFunc("consul-static-task", "*/5 * * * * *", func() error {
        log.Println("Consul Registry: æ‰§è¡Œé™æ€ä»»åŠ¡ (consul-static-task) æ¯5ç§’ä¸€æ¬¡")
        return nil
    })
    if err != nil {
        log.Fatal(err)
    }
    
    // 4. æ·»åŠ åŠ¨æ€ä»»åŠ¡ç¤ºä¾‹ (å¯é€‰)
    err = dc.AddTaskMeta(dcron.TaskMeta{
        Name:       "consul-dynamic-task",
        CronFormat: "*/10 * * * * *",
        Payload:    "Hello from Consul dynamic task",
    })
    if err != nil {
        log.Printf("æ·»åŠ åŠ¨æ€ä»»åŠ¡ consul-dynamic-task å¤±è´¥: %v", err) // éè‡´å‘½é”™è¯¯ï¼Œå¯ä»¥é€‰æ‹©è®°å½•æ—¥å¿—
    }
    
    // 5. å¯åŠ¨æœåŠ¡
    log.Println("Dcron (Consul) æœåŠ¡å¯åŠ¨ä¸­...")
    if err := dc.Start(); err != nil {
        log.Fatal(err)
    }
}
```

#### Redis Registry ç¤ºä¾‹

```go
package main

import (
    "github.com/robfig/cron/v3"
    // "context" // å¦‚æœæ‚¨çš„ Redis æ“ä½œéœ€è¦ context
    "github.com/kkangxu/dcron"
    "github.com/redis/go-redis/v9"
    "log"
    "fmt"
)

func main() {
    // 1. åˆå§‹åŒ– Redis å®¢æˆ·ç«¯
    rdb := redis.NewClient(&redis.Options{
        Addr: "localhost:6379", // Redis æœåŠ¡åœ°å€
    })
    
    // 2. åˆ›å»º Dcron å®ä¾‹ï¼Œä½¿ç”¨ Redis Registry
    dc := dcron.NewDcron(dcron.NewRedisRegistry(rdb), dcron.WithStrategy(dcron.StrategyConsistent), dcron.WithCronOptions(cron.WithSeconds()))
    
    // 3. æ·»åŠ é™æ€ä»»åŠ¡ç¤ºä¾‹
    err := dc.AddFunc("redis-static-task", "*/10 * * * * *", func() error {
        log.Println("Redis Registry: æ‰§è¡Œé™æ€ä»»åŠ¡ (redis-static-task) æ¯10ç§’ä¸€æ¬¡")
        return nil
    })
    if err != nil {
        log.Fatal(err)
    }
    
    // 4. å¯åŠ¨æœåŠ¡
    log.Println("Dcron (Redis) æœåŠ¡å¯åŠ¨ä¸­...")
    if err := dc.Start(); err != nil {
        log.Fatal(err)
    }
}
```

#### Etcd Registry ç¤ºä¾‹

```go
package main

import (
    "github.com/robfig/cron/v3"
    "github.com/kkangxu/dcron"
    "go.etcd.io/etcd/client/v3"
    "log"
    "time"
    "fmt"
)

func main() {
    // 1. åˆå§‹åŒ– Etcd å®¢æˆ·ç«¯
    cli, err := clientv3.New(clientv3.Config{
        Endpoints:   []string{"localhost:2379"}, // Etcd æœåŠ¡åœ°å€
        DialTimeout: 5 * time.Second,
    })
    if err != nil {
        log.Fatalf("è¿æ¥ Etcd å¤±è´¥: %v", err)
    }
    defer cli.Close() // ç¡®ä¿å®¢æˆ·ç«¯å…³é—­
    
    // 2. åˆ›å»º Dcron å®ä¾‹ï¼Œä½¿ç”¨ Etcd Registry
    dc := dcron.NewDcron(dcron.NewEtcdRegistry(cli), dcron.WithStrategy(dcron.StrategyConsistent), dcron.WithCronOptions(cron.WithSeconds()))
    
    // 3. æ·»åŠ é™æ€ä»»åŠ¡ç¤ºä¾‹
    err = dc.AddFunc("etcd-static-task", "*/3 * * * * *", func() error {
        log.Println("Etcd Registry: æ‰§è¡Œé™æ€ä»»åŠ¡ (etcd-static-task) æ¯3ç§’ä¸€æ¬¡")
        return nil
    })
    if err != nil {
        log.Fatal(err)
    }
    
    // 4. å¯åŠ¨æœåŠ¡
    log.Println("Dcron (Etcd) æœåŠ¡å¯åŠ¨ä¸­...")
    if err := dc.Start(); err != nil {
        log.Fatal(err)
    }
}
```

#### ZooKeeper Registry ç¤ºä¾‹

```go
package main

import (
    "github.com/robfig/cron/v3"
    "github.com/kkangxu/dcron"
    "github.com/go-zookeeper/zk"
    "log"
    "time"
    "fmt"
)

func main() {
    // 1. è¿æ¥ ZooKeeper
    conn, _, err := zk.Connect([]string{"127.0.0.1:2181"}, time.Second*5) // ZooKeeper æœåŠ¡åœ°å€
    if err != nil {
        log.Fatalf("è¿æ¥ ZooKeeper å¤±è´¥: %v", err)
    }
    // defer conn.Close() // é€šå¸¸ zk.Conn ç”± dcron å†…éƒ¨ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼Œé™¤éæ‚¨æœ‰ç‰¹æ®Šéœ€æ±‚
    
    // 2. åˆ›å»º Dcron å®ä¾‹ï¼Œä½¿ç”¨ ZooKeeper Registry
    dc := dcron.NewDcron(dcron.NewZookeeperRegistry(conn), dcron.WithStrategy(dcron.StrategyConsistent), dcron.WithCronOptions(cron.WithSeconds()))
    
    // 3. æ·»åŠ é™æ€ä»»åŠ¡ç¤ºä¾‹
    err = dc.AddFunc("zk-static-task", "*/2 * * * * *", func() error {
        log.Println("ZooKeeper Registry: æ‰§è¡Œé™æ€ä»»åŠ¡ (zk-static-task) æ¯2ç§’ä¸€æ¬¡")
        return nil
    })
    if err != nil {
        log.Fatal(err)
    }
    
    // 4. å¯åŠ¨æœåŠ¡
    log.Println("Dcron (ZooKeeper) æœåŠ¡å¯åŠ¨ä¸­...")
    if err := dc.Start(); err != nil {
        log.Fatal(err)
    }
}
```

---

## ğŸ§­ æ ¸å¿ƒæ¦‚å¿µä¸æœºåˆ¶

### åŠ¨æ€ä»»åŠ¡åˆ é™¤ä¸åŒæ­¥

å½“æ‚¨éœ€è¦åˆ é™¤ä¸€ä¸ªåŠ¨æ€ä»»åŠ¡æ—¶ï¼Œåº”è°ƒç”¨ `dc.MarkTaskDeleted("task-name")`ã€‚
æ­¤æ“ä½œä¼šå°†ä»»åŠ¡æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€çŠ¶æ€ï¼Œå¹¶å°†æ­¤çŠ¶æ€åŒæ­¥åˆ°æ³¨å†Œä¸­å¿ƒã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

*   **é˜²æ­¢è„æ•°æ®**ï¼šç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹éƒ½çŸ¥é“è¯¥ä»»åŠ¡å·²è¢«åˆ é™¤ã€‚
*   **é¿å…é‡å¤è°ƒåº¦**ï¼šå…¶ä»–èŠ‚ç‚¹ä¸ä¼šå†å°è¯•è°ƒåº¦å·²æ ‡è®°ä¸ºåˆ é™¤çš„ä»»åŠ¡ã€‚

å¦‚æœåç»­éœ€è¦é‡æ–°å¯ç”¨åŒåä»»åŠ¡ï¼Œå»ºè®®ä½¿ç”¨ `ForceAddTaskMeta` æˆ–å…ˆè°ƒç”¨ `CleanupTask` æ¸…ç†æ—§æ ‡è®°åå†æ·»åŠ ã€‚

### ç”Ÿå‘½å‘¨æœŸä¸èŠ‚ç‚¹çŠ¶æ€

`dcron` ä¸­çš„æœåŠ¡èŠ‚ç‚¹å…·æœ‰æ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼š

*   **`starting`**ï¼šèŠ‚ç‚¹å¯åŠ¨åˆå§‹åŒ–é˜¶æ®µã€‚
*   **`working`**ï¼šèŠ‚ç‚¹æˆåŠŸæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒå¹¶å¼€å§‹æ­£å¸¸å·¥ä½œï¼ˆç›‘å¬ä»»åŠ¡ã€å‚ä¸è°ƒåº¦ç­‰ï¼‰ã€‚
*   **`leaving`**ï¼šèŠ‚ç‚¹å‡†å¤‡å…³é—­æˆ–ä¸‹çº¿ï¼Œä¼šè¿›è¡Œèµ„æºæ¸…ç†å’ŒçŠ¶æ€æ›´æ–°ã€‚

èŠ‚ç‚¹é€€å‡ºæ—¶ï¼Œå…¶åœ¨æ³¨å†Œä¸­å¿ƒçš„ä¿¡æ¯ä¼šè¢«å¦¥å–„å¤„ç†ï¼Œç¡®ä¿ä¸ä¼šå½±å“é›†ç¾¤çš„æ­£å¸¸è¿ä½œã€‚

### åˆ†å¸ƒå¼é”æœºåˆ¶

`dcron` çš„æ ¸å¿ƒè®¾è®¡ä¹‹ä¸€æ˜¯ç¡®ä¿ä»»åŠ¡åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„**å¹‚ç­‰æ€§æ‰§è¡Œ**ï¼Œå³åŒä¸€ä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´ç‚¹åªè¢«é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œã€‚\è¿™æ˜¯é€šè¿‡å†…ç½®çš„åˆ†å¸ƒå¼é”æœºåˆ¶å®ç°çš„ï¼Œä¸»è¦ä¾èµ–äº `Registry` æ¥å£ä¸­çš„ `CanRunTask` æ–¹æ³•ï¼š

```go
// CanRunTask æ£€æŸ¥æŒ‡å®šçš„ä»»åŠ¡åœ¨ç»™å®šçš„æ‰§è¡Œæ—¶é—´ç‚¹æ˜¯å¦å¯ä»¥è¢«å½“å‰èŠ‚ç‚¹æ‰§è¡Œã€‚
// å®ƒå†…éƒ¨ä¼šå°è¯•è·å–è¯¥ä»»åŠ¡åœ¨è¯¥æ—¶é—´ç‚¹çš„åˆ†å¸ƒå¼é”ã€‚
// è¿”å›å€¼ï¼š(æ˜¯å¦å¯ä»¥è¿è¡Œ, é”™è¯¯ä¿¡æ¯)
CanRunTask(ctx context.Context, taskName string, execTime time.Time) (bool, error)
```

**å·¥ä½œåŸç†ç®€è¿°**ï¼š

1.  å½“ä¸€ä¸ªèŠ‚ç‚¹å‡†å¤‡æ‰§è¡ŒæŸä¸ªä»»åŠ¡æ—¶ï¼Œå®ƒä¼šå…ˆè°ƒç”¨ `CanRunTask`ã€‚
2.  `CanRunTask` ä¼šå°è¯•åœ¨æ³¨å†Œä¸­å¿ƒä¸º `taskName` + `execTime` è¿™ä¸ªç»„åˆåˆ›å»ºä¸€ä¸ªçŸ­æš‚çš„ã€å”¯ä¸€çš„æ ‡è®°ï¼ˆå³è·å–é”ï¼‰ã€‚
3.  å¦‚æœæˆåŠŸè·å–é”ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œé€šå¸¸ä¼šé‡Šæ”¾é”ï¼ˆæˆ–é”è‡ªåŠ¨è¿‡æœŸï¼‰ã€‚
4.  å¦‚æœè·å–é”å¤±è´¥ï¼ˆé€šå¸¸æ„å‘³ç€å…¶ä»–èŠ‚ç‚¹å·²ç»è·å–äº†è¯¥ä»»åŠ¡åœ¨è¯¥æ—¶é—´ç‚¹çš„æ‰§è¡Œæƒï¼‰ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¸ä¼šæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚

**ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿ**

*   **é¿å…é‡å¤æ‰§è¡Œ**ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹å¯èƒ½åŒæ—¶æ»¡è¶³ä»»åŠ¡çš„è§¦å‘æ¡ä»¶ã€‚æ²¡æœ‰åˆ†å¸ƒå¼é”ï¼ŒåŒä¸€ä¸ªä»»åŠ¡å¯èƒ½è¢«å¤šä¸ªèŠ‚ç‚¹é‡å¤æ‰§è¡Œï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–å…¶ä»–æ„å¤–è¡Œä¸ºã€‚
*   **ä¿è¯æ•°æ®ä¸€è‡´æ€§**ï¼šå¯¹äºéœ€è¦ä¿®æ”¹å…±äº«èµ„æºçš„ä»»åŠ¡ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªæ‰§è¡Œè€…è‡³å…³é‡è¦ã€‚
*   **é€‚ç”¨äºå¤šç§åœºæ™¯**ï¼š
    *   èŠ‚ç‚¹é¢‘ç¹åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤ã€‚
    *   å¯¹ä»»åŠ¡æ‰§è¡Œçš„å”¯ä¸€æ€§æœ‰ä¸¥æ ¼è¦æ±‚çš„ä¸šåŠ¡ã€‚
    *   ä»»åŠ¡æ‰§è¡Œæ—¶é—´éå¸¸æ•æ„Ÿï¼Œä¸å…è®¸å»¶è¿Ÿæˆ–å› å†²çªè€Œå¤±è´¥ã€‚

`dcron` å°†åˆ†å¸ƒå¼é”çš„å®ç°ç»†èŠ‚å°è£…åœ¨å„ä¸ª `Registry` çš„å…·ä½“å®ç°ä¸­ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚ç»†èŠ‚ï¼Œåªéœ€ç¡®ä¿é€‰æ‹©çš„æ³¨å†Œä¸­å¿ƒæ”¯æŒå¯é çš„åˆ†å¸ƒå¼é”å³å¯ï¼ˆ`dcron` æä¾›çš„æ‰€æœ‰å†…ç½® Registry å‡æ”¯æŒï¼‰ã€‚

---

## âš™ï¸ é…ç½®ä¸ API å‚è€ƒ

### å¯é€‰é…ç½®é¡¹ (Option)

`dcron` å®ä¾‹é€šè¿‡ä¸€ç³»åˆ— `Option` å‡½æ•°è¿›è¡Œé…ç½®ã€‚`Option` æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ `func(*dcron)`ã€‚

| Option                               | æè¿°                                                                 | é»˜è®¤è¡Œä¸º/å¤‡æ³¨                                     |
| ------------------------------------ | -------------------------------------------------------------------- | ------------------------------------------------- |
| `WithStrategy(strategy AssignerStrategy)` | è®¾ç½®ä»»åŠ¡åˆ†é…ç­–ç•¥ã€‚å¯é€‰å€¼ï¼š                                               | é»˜è®¤ä¸º `StrategyConsistent` (ä¸€è‡´æ€§å“ˆå¸Œ)            |
|                                      | `StrategyConsistent` (ä¸€è‡´æ€§å“ˆå¸Œ)                                        |                                                   |
|                                      | `StrategyHashSharding` (å¹³å‡åˆ†é…)                                      |                                                   |
|                                      | `StrategyHashSlot` (å“ˆå¸Œæ§½)                                            |                                                   |
|                                      | `StrategyRange` (èŒƒå›´åˆ†é…)                                             |                                                   |
|                                      | `StrategyWeighted` (åŠ æƒåˆ†é…)                                          | éœ€é…åˆèŠ‚ç‚¹æƒé‡                                      |
|                                      | `StrategyRoundRobin` (è½®è¯¢)                                            |                                                   |
| `WithAssigner(assigner Assigner)`    | è®¾ç½®è‡ªå®šä¹‰çš„ä»»åŠ¡åˆ†é…å™¨ï¼Œæˆ–ä½¿ç”¨ `dcron` å†…ç½®çš„åˆ†é…å™¨å®ä¾‹ã€‚                    | å¦‚æœè®¾ç½®æ­¤é¡¹ï¼Œä¼šè¦†ç›– `WithStrategy` çš„æ•ˆæœã€‚          |
| `WithCronOptions(...)`               | è‡ªå®šä¹‰ `github.com/robfig/cron/v3` çš„é…ç½®ï¼Œå¦‚è®¾ç½®ç§’çº§ç²¾åº¦ `cron.WithSeconds()` | é»˜è®¤ä¸å¸¦ç§’çº§ç²¾åº¦ã€‚                                  |
| `WithTaskRunFunc(handler TaskRunFunc)` | è®¾ç½®åŠ¨æ€ä»»åŠ¡çš„ç»Ÿä¸€æ‰§è¡Œå‡½æ•°ã€‚`TaskRunFunc` ç±»å‹ä¸º `func(*TaskMeta) error`ã€‚ | **å¿…é¡»è®¾ç½®**ï¼Œå¦åˆ™åŠ¨æ€ä»»åŠ¡æ— æ³•æ‰§è¡Œã€‚                  |
| `WithErrHandler(handler ErrHandler)`   | è®¾ç½®ä»»åŠ¡æ‰§è¡Œå‘ç”Ÿé”™è¯¯æ—¶çš„å¤„ç†å‡½æ•°ã€‚`ErrHandler` ç±»å‹ä¸º `func(*TaskMeta, error)`ã€‚ | é»˜è®¤ä¼šå°†é”™è¯¯æ‰“å°åˆ°æ—¥å¿—ã€‚                              |
| `WithLogger(log Logger)`             | è®¾ç½®è‡ªå®šä¹‰æ—¥å¿—è®°å½•å™¨ï¼Œéœ€å®ç° `dcron.Logger` æ¥å£ã€‚                       | é»˜è®¤ä½¿ç”¨å†…ç½®çš„åŸºäº `log` åŒ…çš„ç®€å•æ—¥å¿—è®°å½•å™¨ã€‚         |

**ç¤ºä¾‹ï¼š**
```go
import "github.com/robfig/cron/v3"

dc := dcron.NewDcron(
    registry,
    dcron.WithStrategy(dcron.StrategyRoundRobin), // ä½¿ç”¨è½®è¯¢ç­–ç•¥
    dcron.WithCronOptions(cron.WithParser(cron.NewParser(
        cron.SecondOptional | cron.Minute | cron.Hour | cron.Dom | cron.Month | cron.Dow, // æ”¯æŒå¯é€‰çš„ç§’å­—æ®µ
    ))),
    // ... å…¶ä»– options
)
```

### é”™è¯¯å¤„ç†

æ‚¨å¯ä»¥é€šè¿‡ `WithErrHandler` é€‰é¡¹æ³¨å…¥è‡ªå®šä¹‰çš„ä»»åŠ¡æ‰§è¡Œé”™è¯¯å¤„ç†å‡½æ•°ã€‚è¿™å¯¹äºé›†ä¸­è®°å½•é”™è¯¯ã€å‘é€å‘Šè­¦æˆ–æ‰§è¡Œç‰¹å®šçš„é”™è¯¯æ¢å¤é€»è¾‘éå¸¸æœ‰ç”¨ã€‚

```go
dc := dcron.NewDcron(
    registry,
    dcron.WithErrHandler(func(task *dcron.TaskMeta, err error) {
        // ä½¿ç”¨æ‚¨é¡¹ç›®çš„æ—¥å¿—ç³»ç»Ÿè®°å½•é”™è¯¯
        fmt.Errorf("ä»»åŠ¡ '%s' (Payload: %s) æ‰§è¡Œå¤±è´¥: %v", task.Name, task.Payload, err)
        // æ­¤å¤„å¯ä»¥æ·»åŠ å‘Šè­¦é€»è¾‘ï¼Œä¾‹å¦‚å‘é€é‚®ä»¶æˆ– webhook
    }),
    // ... å…¶ä»– options
)
```
å¦‚æœæ²¡æœ‰é€šè¿‡ `WithErrHandler` è®¾ç½®è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œ`dcron` é»˜è®¤ä¼šå°†é”™è¯¯ä¿¡æ¯æ‰“å°åˆ°å…¶å†…éƒ¨æ—¥å¿—ï¼ˆå¦‚æœé…ç½®äº† `WithLogger`ï¼Œåˆ™ä½¿ç”¨è‡ªå®šä¹‰ loggerï¼›å¦åˆ™ä½¿ç”¨æ ‡å‡† `log` åŒ…ï¼‰ã€‚

### åŠ¨æ€ä»»åŠ¡ç»Ÿä¸€å¤„ç†å‡½æ•°

æ‰€æœ‰åŠ¨æ€ä»»åŠ¡ï¼ˆé€šè¿‡ `AddTaskMeta` æˆ– `ForceAddTaskMeta` æ·»åŠ çš„ä»»åŠ¡ï¼‰çš„å®é™…æ‰§è¡Œé€»è¾‘éƒ½ç”±é€šè¿‡ `WithTaskRunFunc` é€‰é¡¹è®¾ç½®çš„å‡½æ•°æ¥å¤„ç†ã€‚è¿™æä¾›äº†ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹æ¥ç®¡ç†åŠ¨æ€ä»»åŠ¡çš„æ‰§è¡Œã€‚

```go
dc := dcron.NewDcron(
    registry,
    dcron.WithTaskRunFunc(func(task *dcron.TaskMeta) error {
        fmt.Printf("å¼€å§‹æ‰§è¡ŒåŠ¨æ€ä»»åŠ¡: %s\n", task.Name)
        fmt.Printf("ä»»åŠ¡ Cron è¡¨è¾¾å¼: %s\n", task.CronFormat)
        fmt.Printf("ä»»åŠ¡ Payload: %s\n", task.Payload)
        
        // æ ¹æ® task.Name æˆ– task.Payload æ‰§è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘
        switch task.Name {
        case "send-email-report":
            // æ‰§è¡Œå‘é€é‚®ä»¶æŠ¥å‘Šçš„é€»è¾‘
            fmt.Println("æ­£åœ¨å‘é€é‚®ä»¶æŠ¥å‘Š...")
        case "cleanup-temp-files":
            // æ‰§è¡Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶çš„é€»è¾‘
            fmt.Println("æ­£åœ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶...")
        default:
            fmt.Printf("æœªçŸ¥çš„åŠ¨æ€ä»»åŠ¡ç±»å‹: %s\n", task.Name)
        }
        
        // å¦‚æœä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œè¿”å› nil
        // å¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›å…·ä½“çš„ error
        return nil
    }),
    // ... å…¶ä»– options
)
```
**é‡è¦**ï¼šå¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨åŠ¨æ€ä»»åŠ¡ï¼Œ**å¿…é¡»**é€šè¿‡ `WithTaskRunFunc` æä¾›ä¸€ä¸ªå¤„ç†å™¨ï¼Œå¦åˆ™åŠ¨æ€ä»»åŠ¡å°†æ— æ³•è¢«æ‰§è¡Œã€‚

### åŠ¨æ€ä»»åŠ¡ API

ä»¥ä¸‹æ˜¯ç®¡ç†åŠ¨æ€ä»»åŠ¡çš„ä¸»è¦ API æ–¹æ³•ï¼ˆé€šè¿‡ `dcron` å®ä¾‹è°ƒç”¨ï¼‰ï¼š

*   **`AddTaskMeta(meta TaskMeta) error`**
    æ·»åŠ ä¸€ä¸ªæ–°çš„åŠ¨æ€ä»»åŠ¡ã€‚å¦‚æœä»»åŠ¡å·²å­˜åœ¨æˆ–å·²è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚
    ```go
    err := dc.AddTaskMeta(dcron.TaskMeta{
        Name:       "new-dynamic-task",
        CronFormat: "0 * * * *", // æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
        Payload:    "{"report_type":"hourly"}",
    })
    ```

*   **`ForceAddTaskMeta(meta TaskMeta) error`**
    å¼ºåˆ¶æ·»åŠ ä¸€ä¸ªåŠ¨æ€ä»»åŠ¡ã€‚å¦‚æœä»»åŠ¡å·²å­˜åœ¨æˆ–å·²è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œå®ƒå°†è¦†ç›–ç°æœ‰ä»»åŠ¡å¹¶æ¸…é™¤ç›¸å…³æ ‡è®°ã€‚
    ```go
    err := dc.ForceAddTaskMeta(dcron.TaskMeta{
        Name:       "new-dynamic-task", // å¯ä»¥ä¸ä¸Šé¢åŒå
        CronFormat: "0 */2 * * *", // æ¯ä¸¤å°æ—¶æ‰§è¡Œä¸€æ¬¡
        Payload:    "{"report_type":"bi_hourly"}",
    })
    ```

*   **`MarkTaskDeleted(name string) error`**
    å°†æŒ‡å®šçš„åŠ¨æ€ä»»åŠ¡æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚ä»»åŠ¡ä¸ä¼šç«‹å³ä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œä½†ä¸ä¼šå†è¢«è°ƒåº¦æ‰§è¡Œã€‚æ­¤çŠ¶æ€ä¼šåŒæ­¥åˆ°æ³¨å†Œä¸­å¿ƒã€‚
    ```go
    err := dc.MarkTaskDeleted("new-dynamic-task")
    ```

### ä¸»è¦ API æè¿°

ä¸‹è¡¨åˆ—å‡ºäº† `dcron` å®ä¾‹æä¾›çš„ä¸»è¦æ–¹æ³•åŠå…¶æè¿°ã€‚

| æ–¹æ³•å                               | å‚æ•°                                     | è¿”å›ç±»å‹     | æè¿°                                                                                                                               |
| ------------------------------------ | ---------------------------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| `AddTask`                            | `name string, cronExpr string, tasker Tasker` | `error`      | æ·»åŠ ä¸€ä¸ªé™æ€ä»»åŠ¡ï¼Œ`Tasker` æ˜¯ä¸€ä¸ªåŒ…å« `Run() error` æ–¹æ³•çš„æ¥å£ã€‚                                                                         |
| `AddFunc`                            | `name string, cronExpr string, cmd func() error` | `error`      | æ·»åŠ ä¸€ä¸ªé™æ€ä»»åŠ¡ï¼Œæ‰§è¡Œé€»è¾‘ç”±ä¼ å…¥çš„å‡½æ•°æä¾›ã€‚                                                                                             |
| `AddOneShotTask`                     | `name string, cronExpr string, tasker Tasker` | `error`      | æ·»åŠ ä¸€ä¸ªä¸€æ¬¡æ€§é™æ€ä»»åŠ¡ã€‚ä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åä¼šè‡ªåŠ¨ç§»é™¤ã€‚                                                                                         |
| `AddOneShotFunc`                     | `name string, cronExpr string, cmd func() error` | `error`      | æ·»åŠ ä¸€ä¸ªä¸€æ¬¡æ€§é™æ€ä»»åŠ¡ï¼ˆå‡½æ•°å½¢å¼ï¼‰ã€‚ä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åä¼šè‡ªåŠ¨ç§»é™¤ã€‚                                                                                       |
| `AddTaskMeta`                        | `meta TaskMeta`                          | `error`      | æ·»åŠ ä¸€ä¸ªåŠ¨æ€ä»»åŠ¡ã€‚ä»»åŠ¡å…ƒæ•°æ®å­˜å‚¨åœ¨æ³¨å†Œä¸­å¿ƒã€‚å¦‚æœä»»åŠ¡å·²å­˜åœ¨æˆ–å·²åˆ é™¤ï¼Œä¼šæŠ¥é”™ã€‚                                                                       |
| `ForceAddTask`                       | `name string, cronExpr string, tasker Tasker` | `error`      | å¼ºåˆ¶æ·»åŠ é™æ€ä»»åŠ¡ã€‚å¿½ç•¥ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨æˆ–å·²è¢«åˆ é™¤çš„çŠ¶æ€ï¼Œç›´æ¥è¦†ç›–ã€‚                                                                                   |
| `ForceAddFunc`                       | `name string, cronExpr string, cmd func() error` | `error`      | å¼ºåˆ¶æ·»åŠ é™æ€ä»»åŠ¡ï¼ˆå‡½æ•°å½¢å¼ï¼‰ã€‚                                                                                                         |
| `ForceAddOneShotTask`                | `name string, cronExpr string, tasker Tasker` | `error`      | å¼ºåˆ¶æ·»åŠ ä¸€æ¬¡æ€§é™æ€ä»»åŠ¡ã€‚                                                                                                               |
| `ForceAddOneShotFunc`                | `name string, cronExpr string, cmd func() error` | `error`      | å¼ºåˆ¶æ·»åŠ ä¸€æ¬¡æ€§é™æ€ä»»åŠ¡ï¼ˆå‡½æ•°å½¢å¼ï¼‰ã€‚                                                                                                     |
| `ForceAddTaskMeta`                   | `meta TaskMeta`                          | `error`      | å¼ºåˆ¶æ·»åŠ åŠ¨æ€ä»»åŠ¡ã€‚å¿½ç•¥ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨æˆ–å·²è¢«åˆ é™¤çš„çŠ¶æ€ï¼Œç›´æ¥è¦†ç›–ã€‚                                                                                   |
| `ReuseDeletedTask`                   | `name string`                            | `error`      | é‡æ–°ä½¿ç”¨ä¸€ä¸ªä¹‹å‰è¢« `MarkTaskDeleted` æ ‡è®°ä¸ºå·²åˆ é™¤çš„ä»»åŠ¡ã€‚æ­¤æ“ä½œä¼šæ¸…é™¤åˆ é™¤æ ‡è®°ã€‚                                                                      |
| `MarkTaskDeleted`                    | `name string`                            | `error`      | å°†æŒ‡å®šçš„åŠ¨æ€ä»»åŠ¡æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚æ­¤çŠ¶æ€ä¼šåŒæ­¥åˆ°æ³¨å†Œä¸­å¿ƒï¼Œä»»åŠ¡å°†ä¸å†è¢«è°ƒåº¦ã€‚è¦é‡æ–°æ·»åŠ åŒåä»»åŠ¡ï¼Œéœ€ä½¿ç”¨ `ForceAddTaskMeta` æˆ–å…ˆ `CleanupTask`ã€‚                     |
| `CleanupTask`                        | `ctx context.Context, name string`       | `error`      | **å½»åº•æ¸…ç†**æŒ‡å®šä»»åŠ¡çš„æ‰€æœ‰ç›¸å…³æ•°æ®ï¼ŒåŒ…æ‹¬å…¶å…ƒæ•°æ®ã€å·²åˆ é™¤æ ‡è®°ä»¥åŠåœ¨æ³¨å†Œä¸­å¿ƒçš„å…¶ä»–ç—•è¿¹ã€‚å¦‚æœæœåŠ¡é‡å¯åé€šè¿‡ `Add` ç³»åˆ— API é‡æ–°æ·»åŠ ï¼Œä»»åŠ¡ä¼šåƒæ–°ä»»åŠ¡ä¸€æ ·åŠ å…¥ã€‚ |
| `Start`                              |                                          | `error`      | å¯åŠ¨ `dcron` æœåŠ¡ï¼Œå¼€å§‹ä»»åŠ¡è°ƒåº¦å’ŒèŠ‚ç‚¹æ³¨å†Œã€‚                                                                                              |
| `Stop`                               |                                          | `error`      | åœæ­¢ `dcron` æœåŠ¡ï¼Œä¼šæ³¨é”€èŠ‚ç‚¹ã€åœæ­¢è°ƒåº¦å™¨å¹¶é‡Šæ”¾èµ„æºã€‚                                                                                              |
| `GetNodeID`                          |                                          | `string`     | è·å–å½“å‰ `dcron` æœåŠ¡å®ä¾‹çš„èŠ‚ç‚¹ IDã€‚                                                                                                   |
| `GetAllTasks`                        |                                          | `[]string`   | è·å–å½“å‰èŠ‚ç‚¹å·²çŸ¥çš„æ‰€æœ‰ä»»åŠ¡åç§°åˆ—è¡¨ï¼ˆåŒ…æ‹¬é™æ€å’ŒåŠ¨æ€ï¼‰ã€‚                                                                                             |
| `GetMyselfRunningTasks`              |                                          | `[]string`   | è·å–å½“å‰èŠ‚ç‚¹æ­£åœ¨è¿è¡Œï¼ˆå³å·²åˆ†é…ç»™å½“å‰èŠ‚ç‚¹ä¸”å¤„äºè°ƒåº¦å‘¨æœŸå†…ï¼‰çš„ä»»åŠ¡åç§°åˆ—è¡¨ã€‚                                                                               |
| `ForceCleanupAllTasks`               | `ctx context.Context`                    | `error`      | **!!! æåº¦å±é™©æ“ä½œ !!!** å¼ºåˆ¶æ¸…ç†æ³¨å†Œä¸­å¿ƒå†…**æ‰€æœ‰**ä»»åŠ¡çš„å…ƒæ•°æ®å’Œå·²åˆ é™¤ä»»åŠ¡æ ‡è®°ã€‚**ä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œä¸”å¿…é¡»ç¡®ä¿åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®æ··ä¹±ã€‚** |

### TaskMeta ç»“æ„ä½“

`TaskMeta` ç”¨äºå®šä¹‰åŠ¨æ€ä»»åŠ¡çš„å…ƒæ•°æ®ã€‚

```go
type TaskMeta struct {
    Name                   string `json:"name"`                                // ä»»åŠ¡çš„å”¯ä¸€åç§°
    CronFormat             string `json:"cron_format"`                         // Cron è¡¨è¾¾å¼ (ä¾‹å¦‚ "*/5 * * * * *")
    OneShot                bool   `json:"one_shot,omitempty"`                  // æ ‡è®°æ˜¯å¦ä¸ºä¸€æ¬¡æ€§ä»»åŠ¡ã€‚å¦‚æœä¸º trueï¼Œä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åå…¶è¡Œä¸ºå–å†³äºä¸‹é¢ä¸¤ä¸ªå­—æ®µã€‚
    ExecutedAndMarkDeleted bool   `json:"executed_and_mark_deleted,omitempty"` // å¦‚æœ OneShot ä¸º trueï¼Œæ­¤å­—æ®µä¸º true æ—¶ï¼Œä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åä¼šè¢«æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚
    ExecutedAndCleanup     bool   `json:"executed_and_cleanup,omitempty"`      // å¦‚æœ OneShot ä¸º trueï¼Œæ­¤å­—æ®µä¸º true æ—¶ï¼Œä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åä¼šè¢«å½»åº•æ¸…ç† (è°ƒç”¨ CleanupTask)ã€‚æ­¤é€‰é¡¹ä¼˜å…ˆäº ExecutedAndMarkDeletedã€‚
    Payload                string `json:"payload,omitempty"`                   // ä¼ é€’ç»™ä»»åŠ¡æ‰§è¡Œå‡½æ•°çš„è‡ªå®šä¹‰æ•°æ® (é€šå¸¸ä¸º JSON å­—ç¬¦ä¸²)ã€‚
}
```

### Node ç»“æ„ä½“

`Node` ä»£è¡¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ã€‚

```go
type Node struct {
    ID         string     `json:"id"`          // èŠ‚ç‚¹çš„å”¯ä¸€ ID (é€šå¸¸è‡ªåŠ¨ç”Ÿæˆ)
    IP         string     `json:"ip"`          // èŠ‚ç‚¹çš„ IP åœ°å€
    Hostname   string     `json:"hostname"`    // èŠ‚ç‚¹çš„ä¸»æœºå
    LastAlive  time.Time  `json:"last_alive"`  // èŠ‚ç‚¹æœ€åä¸€æ¬¡å¿ƒè·³æ—¶é—´ï¼Œç”¨äºå¥åº·æ£€æŸ¥
    CreateTime time.Time  `json:"create_time"` // èŠ‚ç‚¹çš„æ³¨å†Œåˆ›å»ºæ—¶é—´
    Status     NodeStatus `json:"status"`      // èŠ‚ç‚¹å½“å‰çŠ¶æ€: "starting", "working", æˆ– "leaving"
}

// NodeStatus å®šä¹‰èŠ‚ç‚¹çŠ¶æ€çš„ç±»å‹
type NodeStatus string

const (
    NodeStatusStarting NodeStatus = "starting"
    NodeStatusWorking  NodeStatus = "working"
    NodeStatusLeaving  NodeStatus = "leaving"
)
```

### NodeEvent & TaskEvent

`dcron` å…è®¸æ‚¨é€šè¿‡ `Registry` æ¥å£ç›‘å¬èŠ‚ç‚¹å˜åŒ–å’Œä»»åŠ¡å…ƒæ•°æ®å˜åŒ–äº‹ä»¶ã€‚

```go
// NodeEvent è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹å˜åŒ–äº‹ä»¶
type NodeEvent struct {
    Type NodeEventType // äº‹ä»¶ç±»å‹: NodeEventTypePut (æ–°å¢/æ›´æ–°), NodeEventTypeDelete (åˆ é™¤),  NodeEventTypeChanged (watch node å¯åŠ¨åï¼Œå‘é€è¯¥äº‹ä»¶)
    Node Node          // ç›¸å…³çš„èŠ‚ç‚¹ä¿¡æ¯
}

// NodeEventType å®šä¹‰èŠ‚ç‚¹äº‹ä»¶çš„ç±»å‹
type NodeEventType string

const (
    NodeEventTypePut    NodeEventType = "put"    // èŠ‚ç‚¹æ–°å¢æˆ–ä¿¡æ¯æ›´æ–°
    NodeEventTypeDelete NodeEventType = "delete" // èŠ‚ç‚¹åˆ é™¤
    NodeEventTypeChanged NodeEventType = "changed" // watch node å¯åŠ¨åï¼Œå‘é€è¯¥äº‹ä»¶
)

// TaskMetaEvent è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡å…ƒæ•°æ®å˜åŒ–äº‹ä»¶
type TaskMetaEvent struct {
    Type TaskEventType // äº‹ä»¶ç±»å‹: TaskEventTypePut (æ–°å¢/æ›´æ–°), TaskEventTypeDelete (åˆ é™¤)
    Task TaskMeta      // ç›¸å…³çš„ä»»åŠ¡å…ƒæ•°æ®
}

// TaskEventType å®šä¹‰ä»»åŠ¡äº‹ä»¶çš„ç±»å‹
type TaskEventType string

const (
    TaskEventTypePut    TaskEventType = "put"    // ä»»åŠ¡æ–°å¢æˆ–å…ƒæ•°æ®æ›´æ–°
    TaskEventTypeDelete TaskEventType = "delete" // ä»»åŠ¡è¢«æ ‡è®°ä¸ºåˆ é™¤ (MarkTaskDeleted)
)
```

æ‚¨å¯ä»¥é€šè¿‡ `Registry` æ¥å£çš„ `WatchNodes(ctx context.Context) (<-chan []NodeEvent, error)` å’Œ `WatchTaskEvent(ctx context.Context) (<-chan []TaskMetaEvent, error)` æ–¹æ³•æ¥è·å–è¿™äº›äº‹ä»¶çš„ channelï¼Œä»è€Œåœ¨æ‚¨çš„åº”ç”¨ä¸­å“åº”é›†ç¾¤çŠ¶æ€çš„å˜åŒ–ã€‚

---

## â“ å¸¸è§é—®é¢˜ (FAQ) / ä½¿ç”¨å»ºè®®

1.  **é—®ï¼šä¸ºä»€ä¹ˆè°ƒç”¨ `MarkTaskDeleted` åï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ `AddTaskMeta` å†æ¬¡æ·»åŠ åŒåä»»åŠ¡ï¼Ÿ**
    ç­”ï¼šå½“æ‚¨è°ƒç”¨ `MarkTaskDeleted("task-name")` åï¼Œç³»ç»Ÿä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸ºè¯¥ä»»åŠ¡åè®°å½•ä¸€ä¸ªâ€œå·²åˆ é™¤â€çš„æ ‡è®°ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç”±äºç½‘ç»œå»¶è¿Ÿæˆ–å…¶ä»–åŸå› ï¼Œå·²è¢«åˆ é™¤çš„ä»»åŠ¡è¢«å…¶ä»–èŠ‚ç‚¹é”™è¯¯åœ°é‡æ–°è°ƒåº¦ã€‚è¿™ä¸ªæ ‡è®°èµ·åˆ°äº†ä¸€ä¸ªâ€œå¢“ç¢‘â€çš„ä½œç”¨ã€‚
    å¦‚æœæ‚¨ç¡®å®å¸Œæœ›é‡æ–°ä½¿ç”¨è¿™ä¸ªä»»åŠ¡åï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ¨èæ–¹å¼ï¼š
    *   **ä½¿ç”¨ `ForceAddTaskMeta`**ï¼šè¿™ä¸ªæ–¹æ³•ä¼šå¿½ç•¥æ‰€æœ‰å·²å­˜åœ¨çš„æ ‡è®°ï¼ˆåŒ…æ‹¬â€œå·²åˆ é™¤â€æ ‡è®°ï¼‰ï¼Œå¼ºåˆ¶ç”¨æ–°çš„å…ƒæ•°æ®è¦†ç›–æˆ–åˆ›å»ºä»»åŠ¡ã€‚
    *   **å…ˆè°ƒç”¨ `CleanupTask` å†è°ƒç”¨ `AddTaskMeta`**ï¼š`CleanupTask("task-name")` ä¼šå½»åº•æ¸…é™¤è¯¥ä»»åŠ¡ååœ¨æ³¨å†Œä¸­å¿ƒçš„æ‰€æœ‰ç—•è¿¹ï¼ˆåŒ…æ‹¬å…ƒæ•°æ®å’Œâ€œå·²åˆ é™¤â€æ ‡è®°ï¼‰ã€‚ä¹‹åï¼Œæ‚¨å°±å¯ä»¥åƒæ·»åŠ ä¸€ä¸ªå…¨æ–°çš„ä»»åŠ¡ä¸€æ ·ä½¿ç”¨ `AddTaskMeta`ã€‚
    *   **ä½¿ç”¨ `ReuseDeletedTask`**ï¼šè¿™ä¸ªæ–¹æ³•ä¸“é—¨ç”¨äºâ€œå¤æ´»â€ä¸€ä¸ªå·²è¢«æ ‡è®°ä¸ºåˆ é™¤çš„ä»»åŠ¡ï¼Œå®ƒä¼šæ¸…é™¤åˆ é™¤æ ‡è®°ï¼Œä½¿å¾—ä»»åŠ¡å¯ä»¥è¢«é‡æ–°è°ƒåº¦ï¼ˆå¦‚æœå…¶å…ƒæ•°æ®ä»åœ¨ï¼‰ã€‚

2.  **é—®ï¼š`ForceAddTask` ç³»åˆ—æ–¹æ³•å’Œæ™®é€šçš„ `Add` ç³»åˆ—æ–¹æ³•æœ‰ä»€ä¹ˆæ ¸å¿ƒåŒºåˆ«ï¼Ÿ**
    ç­”ï¼šæ ¸å¿ƒåŒºåˆ«åœ¨äºå¯¹å·²å­˜åœ¨ä»»åŠ¡æˆ–æ ‡è®°çš„å¤„ç†æ–¹å¼ï¼š
    *   **`Add` ç³»åˆ—æ–¹æ³•** (å¦‚ `AddTask`, `AddTaskMeta`)ï¼šåœ¨æ·»åŠ ä»»åŠ¡å‰ä¼šè¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœåŒåä»»åŠ¡å·²å­˜åœ¨ï¼Œæˆ–è€…å·²è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ä¼šè¿”å›é”™è¯¯ï¼Œä»¥é˜²æ­¢æ„å¤–è¦†ç›–æˆ–ä¸æ—§çŠ¶æ€å†²çªã€‚
    *   **`ForceAdd` ç³»åˆ—æ–¹æ³•** (å¦‚ `ForceAddTask`, `ForceAddTaskMeta`)ï¼šæ­£å¦‚å…¶åï¼Œâ€œå¼ºåˆ¶â€æ‰§è¡Œã€‚å®ƒä»¬ä¼šå¿½ç•¥ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨æˆ–å·²è¢«åˆ é™¤çš„å½“å‰çŠ¶æ€ï¼Œç›´æ¥ç”¨æ–°çš„é…ç½®åˆ›å»ºæˆ–è¦†ç›–ä»»åŠ¡ã€‚è¿™é€šå¸¸æ„å‘³ç€å®ƒä»¬ä¼šå…ˆæ¸…ç†æ‰æ³¨å†Œä¸­å¿ƒä¸­ä¸è¯¥ä»»åŠ¡åç›¸å…³çš„ä»»ä½•æ—§è®°å½•ï¼ˆåŒ…æ‹¬å…ƒæ•°æ®ã€å·²åˆ é™¤æ ‡è®°ã€å¯èƒ½çš„æ‰§è¡Œé”ç­‰ï¼‰ï¼Œç„¶åå†å†™å…¥æ–°ä»»åŠ¡çš„ä¿¡æ¯ã€‚è¿™ä½¿å¾—å®ƒä»¬éå¸¸é€‚åˆéœ€è¦â€œå¼ºåˆ¶é‡ç½®â€æˆ–â€œç¡®ä¿æœ€æ–°é…ç½®ç”Ÿæ•ˆâ€çš„åœºæ™¯ã€‚

3.  **é—®ï¼šåŠ¨æ€ä»»åŠ¡å’Œé™æ€ä»»åŠ¡åº”è¯¥å¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨ï¼Ÿ**
    ç­”ï¼š
    *   **é™æ€ä»»åŠ¡**ï¼š
        *   **å®šä¹‰æ–¹å¼**ï¼šé€šå¸¸åœ¨ä»£ç ä¸­é€šè¿‡ `AddFunc` æˆ– `AddTask` ç›´æ¥å®šä¹‰ã€‚
        *   **ç”Ÿå‘½å‘¨æœŸ**ï¼šéšæœåŠ¡å®ä¾‹å¯åŠ¨è€ŒåŠ è½½ï¼ŒéšæœåŠ¡å®ä¾‹åœæ­¢è€Œåœæ­¢ã€‚å…¶å®šä¹‰æ˜¯ç¡¬ç¼–ç åœ¨åº”ç”¨ä¸­çš„ã€‚
        *   **ç®¡ç†**ï¼šä¿®æ”¹é™æ€ä»»åŠ¡é€šå¸¸éœ€è¦é‡æ–°ç¼–è¯‘å’Œéƒ¨ç½²ä»£ç ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šé€‚åˆé‚£äº›é€»è¾‘å›ºå®šã€ä¸å¸¸å˜æ›´ã€ä¸”ä¸åº”ç”¨æ ¸å¿ƒåŠŸèƒ½ç´§å¯†ç›¸å…³çš„å®šæ—¶ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šå®šæœŸçš„æ—¥å¿—åˆ‡å‰²ã€ç³»ç»Ÿå¥åº·æ£€æŸ¥ã€å›ºå®šçš„æ•°æ®åŒæ­¥ç­‰ã€‚
    *   **åŠ¨æ€ä»»åŠ¡**ï¼š
        *   **å®šä¹‰æ–¹å¼**ï¼šé€šè¿‡ `AddTaskMeta` API åœ¨è¿è¡Œæ—¶æ·»åŠ ï¼Œå…¶å…ƒæ•°æ®ï¼ˆå¦‚ Cron è¡¨è¾¾å¼ã€Payloadï¼‰å­˜å‚¨åœ¨æ³¨å†Œä¸­å¿ƒã€‚
        *   **ç”Ÿå‘½å‘¨æœŸ**ï¼šç‹¬ç«‹äºæœåŠ¡å®ä¾‹çš„éƒ¨ç½²ã€‚ä¸€æ—¦æ·»åŠ åˆ°æ³¨å†Œä¸­å¿ƒï¼Œé›†ç¾¤ä¸­çš„ `dcron` èŠ‚ç‚¹å°±ä¼šå‘ç°å¹¶æ ¹æ®åˆ†é…ç­–ç•¥è¿›è¡Œè°ƒåº¦ã€‚å¯ä»¥é€šè¿‡ API è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€‚
        *   **ç®¡ç†**ï¼šæ›´åŠ çµæ´»ï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ç®¡ç†åå°ã€è¿ç»´è„šæœ¬ï¼‰åŠ¨æ€æ§åˆ¶ä»»åŠ¡çš„å¯åœå’Œé…ç½®ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼š
            *   éœ€è¦ç”±è¿è¥æˆ–ç”¨æˆ·åœ¨åå°åŠ¨æ€åˆ›å»ºå’Œç®¡ç†çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„å®šæ—¶æé†’ã€è¥é”€æ´»åŠ¨ç›¸å…³çš„ä¸´æ—¶ä»»åŠ¡ï¼‰ã€‚
            *   éœ€è¦é¢‘ç¹è°ƒæ•´æ‰§è¡Œæ—¶é—´æˆ–å‚æ•°çš„ä»»åŠ¡ã€‚
            *   ä¸´æ—¶æ€§çš„ã€ä¸€æ¬¡æ€§çš„æ•°æ®å¤„ç†æˆ–è¿ç»´æ“ä½œã€‚

4.  **é—®ï¼šå¦‚ä½•æ‰èƒ½å½»åº•æ¸…ç†ä¸€ä¸ªä»»åŠ¡åœ¨æ³¨å†Œä¸­å¿ƒçš„æ‰€æœ‰ç—•è¿¹ï¼Ÿ**
    ç­”ï¼šè°ƒç”¨ `dcron` å®ä¾‹çš„ `CleanupTask(ctx context.Context, taskName string)` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šï¼š
    *   åˆ é™¤ä»»åŠ¡çš„å…ƒæ•°æ®ï¼ˆ`TaskMeta`ï¼‰ã€‚
    *   æ¸…é™¤è¯¥ä»»åŠ¡çš„â€œå·²åˆ é™¤â€æ ‡è®°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚
    *   å°è¯•æ¸…ç†ä¸è¯¥ä»»åŠ¡ç›¸å…³çš„å…¶ä»–æ½œåœ¨æ•°æ®ï¼Œå¦‚æœ€åæ‰§è¡Œæ—¶é—´è®°å½•ã€åˆ†å¸ƒå¼é”æ ‡è®°ç­‰ï¼ˆå…·ä½“å–å†³äºæ³¨å†Œä¸­å¿ƒçš„å®ç°ï¼‰ã€‚
        è°ƒç”¨æ­¤æ–¹æ³•åï¼Œ`taskName` åœ¨æ³¨å†Œä¸­å¿ƒå°†ä¸å†æœ‰ä»»ä½•å…³è”ä¿¡æ¯ï¼Œå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå…¨æ–°çš„å¯ç”¨ä»»åŠ¡åã€‚
        å¦‚æœæ‚¨éœ€è¦ä¸€æ¬¡æ€§æ¸…ç†æ‰€æœ‰ä»»åŠ¡ï¼ˆ**éå¸¸å±é™©ï¼Œä»…é™æµ‹è¯•ï¼**ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `ForceCleanupAllTasks(ctx context.Context)`ã€‚

5.  **é—®ï¼šä¸ºä»€ä¹ˆ `dcron` éœ€è¦â€œå·²åˆ é™¤ä»»åŠ¡åŒæ­¥â€æœºåˆ¶ï¼Ÿ**
    ç­”ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥å¯èƒ½å­˜åœ¨å»¶è¿Ÿã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„â€œå·²åˆ é™¤ä»»åŠ¡â€åˆ—è¡¨å¹¶åœ¨å„èŠ‚ç‚¹é—´åŒæ­¥ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š
    *   ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤äº†ä»»åŠ¡ Aï¼Œä½†å…¶ä»–èŠ‚ç‚¹å¯èƒ½ç”±äºç½‘ç»œå»¶è¿Ÿæˆ–æ‹‰å–ä¿¡æ¯ä¸åŠæ—¶ï¼Œä»ç„¶è®¤ä¸ºä»»åŠ¡ A å­˜åœ¨å¹¶å°è¯•è°ƒåº¦å®ƒã€‚
    *   å¦‚æœè¢«åˆ é™¤çš„ä»»åŠ¡åœ¨è¢«é‡æ–°æ·»åŠ ä¹‹å‰ï¼Œæ—§çš„å®ä¾‹ä»åœ¨æŸäº›èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¯èƒ½å¯¼è‡´å†²çªæˆ–éé¢„æœŸçš„è¡Œä¸ºã€‚
        é€šè¿‡åœ¨æ³¨å†Œä¸­å¿ƒç»´æŠ¤ä¸€ä¸ªâ€œå·²åˆ é™¤ä»»åŠ¡åˆ—è¡¨â€ï¼ˆæˆ–å¯¹ä»»åŠ¡å…ƒæ•°æ®æ‰“ä¸Šåˆ é™¤æ ‡è®°ï¼‰ï¼Œå¹¶è®©æ‰€æœ‰ `dcron` èŠ‚ç‚¹éƒ½èƒ½æ„ŸçŸ¥åˆ°è¿™ä¸ªåˆ—è¡¨ï¼Œå¯ä»¥ç¡®ä¿ï¼š
    *   **å…¨å±€ä¸€è‡´æ€§**ï¼šæ‰€æœ‰èŠ‚ç‚¹å¯¹å“ªäº›ä»»åŠ¡æ˜¯â€œå·²åˆ é™¤â€çŠ¶æ€è¾¾æˆå…±è¯†ã€‚
    *   **é˜²æ­¢â€œåƒµå°¸â€ä»»åŠ¡**ï¼šé¿å…å·²è¢«åˆ é™¤çš„ä»»åŠ¡è¢«é”™è¯¯åœ°é‡æ–°æ¿€æ´»æˆ–æ‰§è¡Œã€‚
    *   **å¹‚ç­‰æ€§ä¿éšœ**ï¼šä¸åˆ†å¸ƒå¼é”æœºåˆ¶é…åˆï¼Œè¿›ä¸€æ­¥å¢å¼ºä»»åŠ¡è°ƒåº¦çš„å‡†ç¡®æ€§ã€‚

6.  **é—®ï¼šå¦‚ä½•å®ç° `dcron` æœåŠ¡çš„ä¼˜é›…åœæœºå’ŒèŠ‚ç‚¹ä¸‹çº¿ï¼Ÿ**
    ç­”ï¼šå½“æ‚¨çš„åº”ç”¨å‡†å¤‡å…³é—­æ—¶ï¼Œåº”è¯¥è°ƒç”¨ `dcron` å®ä¾‹çš„ `Stop()` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œä»¥ç¡®ä¿ä¼˜é›…åœæœºï¼š
    1.  **æ›´æ–°èŠ‚ç‚¹çŠ¶æ€**ï¼šå°†å½“å‰èŠ‚ç‚¹åœ¨æ³¨å†Œä¸­å¿ƒçš„çŠ¶æ€æ›´æ–°ä¸º `leaving`ã€‚è¿™é€šçŸ¥å…¶ä»–èŠ‚ç‚¹è¯¥èŠ‚ç‚¹å³å°†ä¸‹çº¿ï¼Œå®ƒä»¬åœ¨è¿›è¡Œä»»åŠ¡é‡åˆ†é…æ—¶ä¼šè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚
    2.  **åœæ­¢æœ¬åœ°è°ƒåº¦å™¨**ï¼šåœæ­¢ `cron` è°ƒåº¦å™¨ï¼Œä¸å†è§¦å‘æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡é€šå¸¸ä¼šå…è®¸å…¶æ‰§è¡Œå®Œæ¯•ï¼ˆä½†è¿™å–å†³äºä»»åŠ¡æœ¬èº«çš„å®ç°æ˜¯å¦èƒ½å“åº”ä¸­æ–­ä¿¡å·ï¼‰ã€‚
    3.  **æ³¨é”€èŠ‚ç‚¹ä¿¡æ¯**ï¼šä»æ³¨å†Œä¸­å¿ƒç§»é™¤å½“å‰èŠ‚ç‚¹çš„æ³¨å†Œä¿¡æ¯ã€‚
    4.  **é‡Šæ”¾èµ„æº**ï¼šå…³é—­ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ï¼Œé‡Šæ”¾å…¶ä»–å†…éƒ¨èµ„æºã€‚
        é€šè¿‡æ‰§è¡Œè¿™äº›æ­¥éª¤ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å› èŠ‚ç‚¹ä¸‹çº¿å¯¼è‡´çš„ä»»åŠ¡ä¸­æ–­æˆ–é‡å¤è°ƒåº¦é—®é¢˜ï¼Œä¿è¯é›†ç¾¤çš„å¹³ç¨³è¿è¡Œã€‚

7.  **é—®ï¼š`dcron` æ”¯æŒå“ªäº›æ³¨å†Œä¸­å¿ƒï¼Ÿå¦‚æœæˆ‘æƒ³ä» Consul åˆ‡æ¢åˆ° Redisï¼Œéœ€è¦ä¿®æ”¹å¾ˆå¤šä»£ç å—ï¼Ÿ**
    ç­”ï¼š`dcron` ç›®å‰å†…ç½®æ”¯æŒ Consulã€Redisã€Etcd å’Œ ZooKeeperã€‚
    åˆ‡æ¢æ³¨å†Œä¸­å¿ƒéå¸¸ç®€å•ï¼Œå› ä¸º `dcron` çš„æ ¸å¿ƒé€»è¾‘ä¸ `Registry` æ¥å£è§£è€¦ã€‚æ‚¨ä¸»è¦éœ€è¦åšçš„æ”¹åŠ¨æ˜¯ï¼š
    1.  **ä¿®æ”¹ä¾èµ–**ï¼šç¡®ä¿æ‚¨çš„ `go.mod` ä¸­åŒ…å«äº†ç›®æ ‡æ³¨å†Œä¸­å¿ƒçš„å®¢æˆ·ç«¯åº“ï¼ˆä¾‹å¦‚ï¼Œä» `github.com/hashicorp/consul/api` åˆ‡æ¢åˆ° `github.com/redis/go-redis/v9`ï¼‰ã€‚
    2.  **ä¿®æ”¹åˆå§‹åŒ–ä»£ç **ï¼šåœ¨åˆ›å»º `Dcron` å®ä¾‹æ—¶ï¼Œä¼ å…¥æ–°çš„ `Registry` å®ç°ã€‚ä¾‹å¦‚ï¼š
        ```go
        // åŸ Consul åˆå§‹åŒ–
        // import "github.com/hashicorp/consul/api"
        // consulClient, _ := api.NewClient(api.DefaultConfig())
        // registry := dcron.NewConsulRegistry(consulClient)

        // æ–° Redis åˆå§‹åŒ–
        import "github.com/redis/go-redis/v9"
        rdb := redis.NewClient(&redis.Options{Addr: "localhost:6379"})
        registry := dcron.NewRedisRegistry(rdb) // åªéœ€è¦æ”¹è¿™é‡Œ

        dc := dcron.NewDcron(registry, /* ... options ... */)
        ```
    æ‚¨çš„ä»»åŠ¡å®šä¹‰ï¼ˆé™æ€ä»»åŠ¡çš„ `AddFunc` è°ƒç”¨ã€åŠ¨æ€ä»»åŠ¡çš„ `TaskMeta` ç»“æ„ï¼‰å’Œ `dcron` çš„å…¶ä»–é…ç½®é€‰é¡¹ï¼ˆå¦‚ `WithStrategy`, `WithErrHandler` ç­‰ï¼‰é€šå¸¸æ— éœ€ä»»ä½•ä¿®æ”¹ã€‚

8.  **é—®ï¼šæˆ‘å¦‚ä½•ç›‘å¬é›†ç¾¤ä¸­èŠ‚ç‚¹æˆ–ä»»åŠ¡çš„å˜åŒ–ï¼Œä¾‹å¦‚å®ç°ä¸€ä¸ªç›‘æ§ä»ªè¡¨ç›˜ï¼Ÿ**
    ç­”ï¼š`Registry` æ¥å£æä¾›äº† `Watch` æœºåˆ¶æ¥ç›‘å¬è¿™äº›å˜åŒ–ï¼š
    *   **ç›‘å¬èŠ‚ç‚¹å˜åŒ–**ï¼š`registry.WatchNodes(ctx context.Context) (<-chan []NodeEvent, error)`
        è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª channelï¼Œå½“é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åŠ å…¥ã€ç¦»å¼€æˆ–çŠ¶æ€æ›´æ–°æ—¶ï¼Œæ‚¨ä¼šé€šè¿‡è¿™ä¸ª channel æ”¶åˆ° `NodeEvent` äº‹ä»¶çš„åˆ‡ç‰‡ã€‚
    *   **ç›‘å¬ä»»åŠ¡å…ƒæ•°æ®å˜åŒ–**ï¼š`registry.WatchTaskEvent(ctx context.Context) (<-chan []TaskMetaEvent, error)`
        ç±»ä¼¼åœ°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª channelï¼Œå½“åŠ¨æ€ä»»åŠ¡è¢«æ·»åŠ ã€ä¿®æ”¹æˆ–æ ‡è®°ä¸ºåˆ é™¤æ—¶ï¼Œæ‚¨ä¼šæ”¶åˆ° `TaskMetaEvent` äº‹ä»¶çš„åˆ‡ç‰‡ã€‚

    æ‚¨å¯ä»¥åœ¨æ‚¨çš„åº”ç”¨ä¸­å¯åŠ¨ä¸€ä¸ª goroutine æ¥æ¶ˆè´¹è¿™äº› channel ä¸­çš„äº‹ä»¶ï¼Œå¹¶æ ¹æ®äº‹ä»¶ç±»å‹æ›´æ–°æ‚¨çš„ç›‘æ§ä»ªè¡¨ç›˜ã€å‘é€é€šçŸ¥æˆ–æ‰§è¡Œå…¶ä»–è‡ªåŠ¨åŒ–è¿ç»´æ“ä½œã€‚
    ```go
    // ç¤ºä¾‹ï¼šç›‘å¬èŠ‚ç‚¹äº‹ä»¶
    go func() {
        nodeEventsChan, err := registry.WatchNodes(context.Background()) // ä½¿ç”¨åˆé€‚çš„ context
        if err != nil {
            log.Printf("æ— æ³•ç›‘å¬èŠ‚ç‚¹äº‹ä»¶: %v", err)
            return
        }
        for events := range nodeEventsChan {
            for _, event := range events {
                log.Printf("èŠ‚ç‚¹äº‹ä»¶: ç±»å‹=%s, èŠ‚ç‚¹ID=%s, çŠ¶æ€=%s", event.Type, event.Node.ID, event.Node.Status)
                // åœ¨è¿™é‡Œæ›´æ–°æ‚¨çš„ç›‘æ§ç³»ç»Ÿ
            }
        }
    }()
    ```

9.  **é—®ï¼šå¦‚ä½•ä¸ºæ‰€æœ‰åŠ¨æ€ä»»åŠ¡è‡ªå®šä¹‰ç»Ÿä¸€çš„æ‰§è¡Œé€»è¾‘ï¼Ÿ**
    ç­”ï¼šé€šè¿‡ `dcron.WithTaskRunFunc(handler func(*dcron.TaskMeta) error)` é€‰é¡¹ã€‚æ‚¨éœ€è¦æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ª `*dcron.TaskMeta` å‚æ•°å¹¶è¿”å›ä¸€ä¸ª `error`ã€‚å½“ä»»ä½•åŠ¨æ€ä»»åŠ¡åˆ°è¾¾å…¶æ‰§è¡Œæ—¶é—´ç‚¹å¹¶è¢«å½“å‰èŠ‚ç‚¹é€‰ä¸­æ‰§è¡Œæ—¶ï¼Œ`dcron` å°±ä¼šè°ƒç”¨æ‚¨æä¾›çš„è¿™ä¸ª `handler` å‡½æ•°ï¼Œå¹¶å°†è¯¥ä»»åŠ¡çš„ `TaskMeta` ä¿¡æ¯ä¼ é€’ç»™å®ƒã€‚
    åœ¨è¿™ä¸ª `handler` å‡½æ•°å†…éƒ¨ï¼Œæ‚¨å¯ä»¥ï¼š
    *   é€šè¿‡ `task.Name` æ¥åŒºåˆ†ä¸åŒçš„åŠ¨æ€ä»»åŠ¡ã€‚
    *   é€šè¿‡ `task.Payload` è·å–ä¼ é€’ç»™è¯¥ä»»åŠ¡çš„è‡ªå®šä¹‰æ•°æ®ã€‚
    *   æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚
    *   è¿”å› `nil` è¡¨ç¤ºä»»åŠ¡æˆåŠŸæ‰§è¡Œï¼Œè¿”å› `error` è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼ˆè¿™å°†è§¦å‘é€šè¿‡ `WithErrHandler` è®¾ç½®çš„é”™è¯¯å¤„ç†å™¨ï¼‰ã€‚
        è¿™æ˜¯å®ç°åŠ¨æ€ä»»åŠ¡è°ƒåº¦åŠŸèƒ½çš„æ ¸å¿ƒæ‰©å±•ç‚¹ã€‚

10. **é—®ï¼š`dcron` æä¾›äº†å¤šç§ä»»åŠ¡åˆ†é…ç­–ç•¥ï¼Œæˆ‘åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ**
    ç­”ï¼šé€‰æ‹©å“ªç§ç­–ç•¥å–å†³äºæ‚¨çš„å…·ä½“éœ€æ±‚å’Œé›†ç¾¤ç‰¹æ€§ï¼š
    *   **`StrategyConsistent` (ä¸€è‡´æ€§å“ˆå¸Œ)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šå½“èŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–ï¼ˆå¢åŠ æˆ–å‡å°‘ï¼‰æ—¶ï¼Œåªä¼šå½±å“åˆ°å°‘é‡ä»»åŠ¡çš„é‡æ–°åˆ†é…ï¼Œå¤§å¤šæ•°ä»»åŠ¡çš„åˆ†é…ä¿æŒç¨³å®šã€‚èŠ‚ç‚¹é—´çš„ä»»åŠ¡åˆ†é…ç›¸å¯¹å‡åŒ€ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šèŠ‚ç‚¹å¯èƒ½é¢‘ç¹å˜åŠ¨ï¼ˆä¾‹å¦‚å¼¹æ€§ä¼¸ç¼©çš„é›†ç¾¤ï¼‰ã€ä»»åŠ¡æ•°é‡è¾ƒå¤§ã€å¸Œæœ›ä»»åŠ¡åˆ†é…å°½å¯èƒ½å¹³æ»‘è¿‡æ¸¡çš„åœºæ™¯ã€‚
    *   **`StrategyHashSharding` (å¹³å‡åˆ†é… / å“ˆå¸Œå–æ¨¡)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šå®ç°ç®€å•ï¼Œè®¡ç®—å¼€é”€å°ã€‚åœ¨èŠ‚ç‚¹æ•°é‡å›ºå®šæ—¶ï¼Œä»»åŠ¡åˆ†é…éå¸¸å‡åŒ€ã€‚
        *   **ç¼ºç‚¹**ï¼šå½“èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œç»å¤§å¤šæ•°ä»»åŠ¡çš„åˆ†é…éƒ½ä¼šæ”¹å˜ï¼Œå¯èƒ½å¯¼è‡´è¾ƒå¤§çš„ä»»åŠ¡è¿ç§»æ³¢åŠ¨ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šèŠ‚ç‚¹æ•°é‡ç›¸å¯¹ç¨³å®šã€ä»»åŠ¡é‡é€‚ä¸­ã€å¯¹èŠ‚ç‚¹å˜åŠ¨æ—¶çš„ä»»åŠ¡è¿ç§»ä¸æ•æ„Ÿçš„åœºæ™¯ã€‚
    *   **`StrategyHashSlot` (å“ˆå¸Œæ§½)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šå°†ä»»åŠ¡æ˜ å°„åˆ°å›ºå®šæ•°é‡çš„æ§½ä½ä¸Šï¼Œå†å°†æ§½ä½åˆ†é…ç»™èŠ‚ç‚¹ã€‚èŠ‚ç‚¹å¢åˆ æ—¶ï¼Œåªéœ€è¿ç§»å°‘é‡æ§½ä½åŠå…¶ä¸Šçš„ä»»åŠ¡ï¼Œæ¯”çº¯å“ˆå¸Œå–æ¨¡æ›´å¹³æ»‘ã€‚å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„è´Ÿè½½å‡è¡¡ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šå¸Œæœ›åœ¨èŠ‚ç‚¹å˜åŠ¨æ—¶æœ‰æ¯”å“ˆå¸Œå–æ¨¡æ›´å¥½çš„ç¨³å®šæ€§ï¼ŒåŒæ—¶ä¿æŒè¾ƒå¥½å‡åŒ€æ€§çš„åœºæ™¯ï¼Œç±»ä¼¼äº Redis Cluster çš„æ§½ä½æ€æƒ³ã€‚
    *   **`StrategyRange` (èŒƒå›´åˆ†é…)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šæ ¹æ®ä»»åŠ¡åç§°çš„æ’åºå’ŒèŒƒå›´å°†è¿ç»­çš„ä»»åŠ¡å—åˆ†é…ç»™èŠ‚ç‚¹ã€‚é€‚åˆä»»åŠ¡åç§°å…·æœ‰æŸç§æœ‰åºæ€§æˆ–ä¸šåŠ¡å…³è”æ€§çš„åœºæ™¯ã€‚
        *   **ç¼ºç‚¹**ï¼šå¦‚æœä»»åŠ¡åç§°åˆ†å¸ƒä¸å‡ï¼Œå¯èƒ½å¯¼è‡´èŠ‚ç‚¹è´Ÿè½½ä¸å‡ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šä»»åŠ¡å¯ä»¥æŒ‰åç§°é€»è¾‘åˆ†æ®µå¤„ç†çš„åœºæ™¯ï¼Œä¾‹å¦‚æŒ‰å­—æ¯é¡ºåºæˆ–æ•°å­—èŒƒå›´åˆ’åˆ†ä»»åŠ¡ã€‚
    *   **`StrategyWeighted` (åŠ æƒåˆ†é…)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šå…è®¸ä¸ºä¸åŒèŠ‚ç‚¹è®¾ç½®ä¸åŒçš„æƒé‡ï¼Œå¤„ç†èƒ½åŠ›å¼ºçš„èŠ‚ç‚¹å¯ä»¥åˆ†é…æ›´å¤šä»»åŠ¡ã€‚
        *   **ç¼ºç‚¹**ï¼šéœ€è¦é¢„å…ˆè¯„ä¼°å¹¶é…ç½®å„èŠ‚ç‚¹çš„æƒé‡ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šé›†ç¾¤ä¸­å„èŠ‚ç‚¹å¤„ç†èƒ½åŠ›ä¸å‡è¡¡ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨é…ç½®ä¸åŒï¼‰çš„åœºæ™¯ã€‚
    *   **`StrategyRoundRobin` (è½®è¯¢)**ï¼š
        *   **ä¼˜ç‚¹**ï¼šç®€å•å…¬å¹³ï¼Œä¾æ¬¡å°†ä»»åŠ¡åˆ†é…ç»™æ¯ä¸ªèŠ‚ç‚¹ã€‚
        *   **ç¼ºç‚¹**ï¼šä¸è€ƒè™‘ä»»åŠ¡æœ¬èº«çš„ç‰¹æ€§æˆ–èŠ‚ç‚¹çš„å½“å‰è´Ÿè½½ã€‚å¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´å·®å¼‚å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´æŸäº›èŠ‚ç‚¹ç©ºé—²è€Œå¦ä¸€äº›èŠ‚ç‚¹ç¹å¿™ã€‚
        *   **é€‚ç”¨åœºæ™¯**ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸è¿‘ã€èŠ‚ç‚¹å¤„ç†èƒ½åŠ›å‡ç­‰ã€å¸Œæœ›æœ€ç®€å•å…¬å¹³åˆ†é…çš„åœºæ™¯ã€‚

    **é€‰æ‹©å»ºè®®**ï¼š
    *   å¯¹äºå¤§å¤šæ•°é€šç”¨åœºæ™¯ï¼Œ**`StrategyConsistent` (ä¸€è‡´æ€§å“ˆå¸Œ)** æ˜¯ä¸€ä¸ªä¸é”™çš„é»˜è®¤é€‰æ‹©ï¼Œå› ä¸ºå®ƒåœ¨åŠ¨æ€ç¯å¢ƒå’Œè´Ÿè½½å‡è¡¡æ–¹é¢è¡¨ç°å‡è¡¡ã€‚
    *   å¦‚æœæ‚¨çš„èŠ‚ç‚¹éå¸¸ç¨³å®šï¼Œå¯ä»¥è€ƒè™‘ **`StrategyHashSharding`** æˆ– **`StrategyRoundRobin`** ä»¥æ±‚ç®€å•ã€‚
    *   å¦‚æœå¯¹èŠ‚ç‚¹å˜åŠ¨æ—¶çš„ä»»åŠ¡è¿ç§»æœ‰è¾ƒé«˜è¦æ±‚ï¼Œä¸”å¸Œæœ›æ¯”ä¸€è‡´æ€§å“ˆå¸Œæœ‰æ›´ç»†è‡´çš„æ§åˆ¶ï¼ˆæˆ–æœ‰ç±»ä¼¼ Redis Cluster çš„ç»éªŒï¼‰ï¼Œå¯ä»¥è€ƒè™‘ **`StrategyHashSlot`**ã€‚
    *   ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚æŒ‰ååˆ†åŒºã€èŠ‚ç‚¹å¼‚æ„ï¼‰åˆ™å¯¹åº”é€‰æ‹© **`StrategyRange`** æˆ– **`StrategyWeighted`**ã€‚

---

## ğŸ“ æ€»ç»“

`dcron` é¡¹ç›®æ—¨åœ¨æä¾›ä¸€ä¸ªå¼ºå¤§ã€çµæ´»ä¸”æ˜“äºæ‰©å±•çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ”¯æŒå¤šç§ä¸»æµæ³¨å†Œä¸­å¿ƒå’Œä¸°å¯Œçš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ‚¨åœ¨å¾®æœåŠ¡æ¶æ„ä¸­é«˜æ•ˆã€å¯é åœ°è°ƒåº¦å’Œç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚

ğŸ”§ **æ¨èç”¨é€”**ï¼š

*   å¾®æœåŠ¡æ¶æ„ä¸­å„ç±»å®šæ—¶ä»»åŠ¡çš„ç»Ÿä¸€è°ƒåº¦ä¸ç®¡ç†ã€‚
*   éœ€è¦é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡çš„å®šæ—¶ä»»åŠ¡åœºæ™¯ã€‚
*   é€šè¿‡åå°ç®¡ç†ç•Œé¢æˆ–è¿ç»´è„šæœ¬åŠ¨æ€ä¸‹å‘ã€æ§åˆ¶å’Œç›‘æ§å®šæ—¶ä»»åŠ¡ã€‚
*   å®ç°ä¸€æ¬¡æ€§ã€å‘¨æœŸæ€§æˆ–ä¸´æ—¶çš„è‡ªåŠ¨åŒ–è¿ç»´å’Œæ•°æ®å¤„ç†ä½œä¸šã€‚

æˆ‘ä»¬é¼“åŠ±æ‚¨æ ¹æ®é¡¹ç›®çš„å®é™…éœ€æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„æ³¨å†Œä¸­å¿ƒå’Œé…ç½®é€‰é¡¹ï¼Œå¹¶å……åˆ†åˆ©ç”¨ `dcron` æä¾›çš„å„é¡¹åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ [GitHub Issues](https://github.com/kkangxu/dcron/issues) (å‡è®¾é¡¹ç›®åœ°å€) ä¸æˆ‘ä»¬äº¤æµã€‚

---
---